<div class="bg-slate-900/80 border-t border-slate-700 px-6 py-6 animate-fade-in-down">

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

    <div class="space-y-6">

      <!-- KI summary -->
      <div class="bg-slate-800 p-4 rounded-lg border border-slate-700 relative">
        <div
          class="absolute -top-3 left-4 bg-slate-700 px-2 text-xs font-bold text-emerald-400 rounded uppercase">
          KI Zusammenfassung
        </div>
        <p class="text-slate-300 leading-relaxed text-sm mt-1">{{ offer().summary }}</p>
      </div>

      <!-- Keyfacts -->
      <div>
        <h3 class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-3">Keyfacts</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
          <div class="md:col-span-2  bg-slate-800/50 p-3 rounded border border-slate-700/50">
            <span class="text-slate-500 block text-xs mb-1">Aufgaben</span>
            <span class="text-slate-200">{{ offer().tasks }}</span>
          </div>
          <div class="bg-slate-800/50 p-3 rounded border border-slate-700/50">
            <span class="text-slate-500 block text-xs mb-1">Erfahrung</span>
            <span class="text-slate-200">{{ offer().experience }}</span>
          </div>
          <div class="bg-slate-800/50 p-3 rounded border border-slate-700/50">
            <span class="text-slate-500 block text-xs mb-1">Arbeitsmodell</span>
            <span class="text-slate-200">{{ offer().workingModel }}</span>
          </div>
          <div class="bg-slate-800/50 p-3 rounded border border-slate-700/50">
            <span class="text-slate-500 block text-xs mb-1">Benefits</span>
            <span class="text-slate-200">{{ offer().benefits }}</span>
          </div>
          <div class="bg-slate-800/50 p-3 rounded border border-slate-700/50">
            <span class="text-slate-500 block text-xs mb-1">Kultur</span>
            <span class="text-slate-200">{{ offer().culture }}</span>
          </div>
        </div>
      </div>

    </div>


    <div class="space-y-6">

      <!-- Match Logic -->
      <div class="bg-slate-800 p-4 rounded-lg border border-slate-700">
        <h3 class="text-sm font-bold text-white mb-2 flex justify-between">
          KI Match Analyse
          <span class="text-emerald-400">{{ offer().matchScore }}%</span>
        </h3>
        <p class="text-xs text-slate-400 italic">"{{ offer().matchReasoning }}"</p>
      </div>

      <!-- Techstack badges -->
      <div>
        <h3 class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-3">Tech Stack</h3>
        <div class="flex flex-wrap gap-2">
          @for (skill of offer().techstack; track skill) {
            <span
              class="px-2 py-1 bg-slate-800 hover:bg-slate-700 text-slate-300 border border-slate-600 rounded text-xs transition cursor-default">
                          {{ skill }}
                        </span>
          }
        </div>
      </div>

      <!-- Status -->
      <div>
        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Bewerbungsstatus</label>
        <select
          class="w-full p-3 bg-slate-950 text-white rounded-lg border border-slate-700 focus:border-blue-500 outline-none cursor-pointer"
          [(ngModel)]="offer().status">
          <option>Neu</option>
          <option>Beworben</option>
          <option>Warten</option>
          <option>Einladung Kennenlernen</option>
          <option>Einladung Vorstellungsgespr√§ch</option>
          <option>Einladung Teamgespr√§ch</option>
          <option>Challenge</option>
          <option>Zusage</option>
          <option>Absage</option>
        </select>
      </div>

      <!-- Comment -->
      <div>
        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Dein Kommentar</label>
        <textarea
          class="w-full p-3 bg-slate-950 text-slate-200 rounded-lg border border-slate-700 focus:border-blue-500 focus:ring-1 focus:ring-blue-500 outline-none text-sm transition"
          rows="5"
          [(ngModel)]="offer().comment"
          placeholder="Notizen zum Bewerbungsgespr√§ch..."></textarea>
      </div>

      <div>
        <h3 class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-3">
          Relevante Links
        </h3>

        <!-- Wenn NICHT im Bearbeitungsmodus -->
        @if (!isEditingSocial()) {

          <!-- Wenn KEINE URLs hinterlegt -->
          @if (!offer().urlKununu && !offer().urlLinkedin && !offer().urlCompany) {
            <p class="text-slate-500 text-sm mb-3">Keine Links gespeichert.</p>

            <button
              class="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded font-bold"
              (click)="startEditLinks()">
              ‚ûï Links hinzuf√ºgen
            </button>
          }

          <!-- Wenn URLs existieren ‚Üí Buttons anzeigen -->
          @if (offer().urlKununu || offer().urlLinkedin || offer().urlCompany) {
            <div class="flex flex-wrap gap-3 mb-3">
              @if (offer().urlCompany) {
                <a
                  [href]="offer().urlCompany"
                  target="_blank"
                  class="px-3 py-1 bg-slate-800 hover:bg-slate-700 text-indigo-400 border border-slate-600 rounded text-xl">
                  Firmenwebsite
                </a>
              }

              @if (offer().urlKununu) {
                <a
                  [href]="offer().urlKununu"
                  target="_blank"
                  class="px-3 py-1 bg-slate-800 hover:bg-slate-700 text-yellow-400 border border-slate-600 rounded text-xl">
                  Kununu
                </a>
              }

              @if (offer().urlLinkedin) {
                <a
                  [href]="offer().urlLinkedin"
                  target="_blank"
                  class="px-3 py-1 bg-slate-800 hover:bg-slate-700 text-sky-400 border border-slate-600 rounded text-xl">
                  LinkedIn
                </a>
              }


              <button
                class="px-4 py-2 hover:bg-slate-600 text-white rounded font-bold"
                (click)="startEditLinks()">
                ‚úèÔ∏è
              </button>
            </div>
          }

        }

        <!-- BEARBEITUNGSMODUS -->
        @if (isEditingSocial()) {

          <div class="space-y-3 mt-2">

            <div>
              <label class="text-xs text-slate-400">Unternehmenswebsite</label>
              <input
                class="w-full p-2 bg-slate-950 text-white rounded border border-slate-700"
                [(ngModel)]="offer().urlCompany"
                placeholder="https://www.company.com/...">
            </div>

            <div>
              <label class="text-xs text-slate-400">Kununu URL</label>
              <input
                class="w-full p-2 bg-slate-950 text-white rounded border border-slate-700"
                [(ngModel)]="offer().urlKununu"
                placeholder="https://www.kununu.com/...">
            </div>

            <div>
              <label class="text-xs text-slate-400">LinkedIn URL</label>
              <input
                class="w-full p-2 bg-slate-950 text-white rounded border border-slate-700"
                [(ngModel)]="offer().urlLinkedin"
                placeholder="https://www.linkedin.com/...">
            </div>

            <div class="flex gap-3 pt-3">


              <button
                class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded font-bold"
                (click)="finishEditLinks()">
                Bearbeiten schlie√üen
              </button>
            </div>

          </div>
        }

      </div>

      @if (offer().timeline && offer().timeline!!.length > 0) {
        <h3 class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-3">
          Bewerbungsverlauf
        </h3>
        <div class="bg-slate-800/50 p-4 rounded-lg border border-slate-700/50">
          <div class="relative border-l-2 border-slate-700 ml-2 space-y-6 py-1">
            @for (entry of offer().timeline; track entry) {
              <div class="ml-5.5 mb-3 relative">
                <span
                  class="absolute -left-[31px] top-0.5 flex h-4 w-4 items-center justify-center rounded-full bg-slate-900 ring-2 ring-slate-800">
                  <span class="h-2 w-2 rounded-full"
                        [ngClass]="{
                      'bg-emerald-500': entry.status === 'Zusage',
                      'bg-rose-500': entry.status === 'Absage',
                      'bg-blue-500': entry.status === 'Neu',
                      'bg-yellow-500': entry.status !== 'Zusage' && entry.status !== 'Absage' && entry.status !== 'Neu'
                    }">
                  </span>
                </span>

                <div class="flex flex-col">
                  <span class="text-sm font-bold text-white">{{ entry.status }}</span>
                  <span class="text-[10px] text-slate-500 uppercase tracking-wide">
                    {{ entry.changedAt | date:'dd.MM.yy HH:mm' }}
                  </span>
                </div>
              </div>
            }
          </div>
        </div>
      }

      <div class="flex justify-end pt-2">
        <button
          (click)="saveChanges()"
          [disabled]="isSaving()"
          class="flex items-center gap-2 px-6 py-2.5 rounded-lg font-bold shadow-lg transition-all duration-300 transform active:scale-95 text-white min-w-[180px] justify-center"
          [ngClass]="{
      'bg-slate-600 cursor-wait': isSaving(),
      'bg-green-500 hover:bg-green-600': isSavedSuccess(),
      'bg-emerald-600 hover:bg-emerald-700': !isSaving() && !isSavedSuccess()
    }">

          @if (isSaving()) {
            <!-- Spinner -->
            <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
                 viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>Speichere...</span>
          } @else if (isSavedSuccess()) {
            <span class="text-xl">‚úì</span>
            <span>Gespeichert!</span>
          } @else {
            <span>üíæ √Ñnderungen speichern</span>
          }
        </button>
      </div>

    </div>
  </div>

</div>
